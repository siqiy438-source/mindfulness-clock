<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçµèŠ±å›­ | Mind Garden</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2F5233',
                        mint: '#B4F8C8',
                        sage: '#A0E7E5',
                        accent: '#FFAEBC',
                        card: 'rgba(255, 255, 255, 0.7)'
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'pulse-gentle': 'pulse-gentle 4s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        'pulse-gentle': {
                            '0%, 100%': { opacity: 0.6, transform: 'scale(1)' },
                            '50%': { opacity: 1, transform: 'scale(1.1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* è‡ªå®šä¹‰æ ·å¼è¡¥å…… */
        body {
            /* æ¨¡æ‹Ÿ Lovable çš„æ¸å˜èƒŒæ™¯ */
            background: linear-gradient(180deg, #E0F8E0 0%, #F5FFF5 100%);
        }
        
        /* å‘¼å¸çƒåŠ¨ç”»æ ¸å¿ƒ */
        .breathing-circle-container {
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .breathing-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #B4F8C8 0%, #A0E7E5 100%);
            box-shadow: 0 0 40px rgba(160, 231, 229, 0.4);
            position: absolute;
            transition: all 4s ease-in-out;
            transform: scale(1);
        }

        /* å‘¼å¸çŠ¶æ€ */
        .inhale .breathing-circle { transform: scale(1.6); opacity: 0.9; }
        .hold .breathing-circle { transform: scale(1.6); opacity: 0.9; } /* ä¿æŒå¸æ°”çŠ¶æ€ */
        .exhale .breathing-circle { transform: scale(1); opacity: 0.7; }
        
        /* æ–‡å­—å±‚çº§ */
        .circle-text {
            position: relative;
            z-index: 10;
            font-size: 1.5rem;
            color: #2F5233;
            font-weight: 800;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #CBD5E1;
            transition: all 0.3s;
        }
        .step-dot.active {
            background-color: #FFAEBC;
            transform: scale(1.4);
        }
        .step-line {
            flex: 1;
            height: 2px;
            background-color: #E2E8F0;
        }
        
        /* SVG è£…é¥°å®šä½ */
        .deco-cloud { position: absolute; fill: #fff; opacity: 0.6; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); }
        .deco-leaf { position: absolute; fill: #B4F8C8; opacity: 0.8; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center overflow-hidden relative text-forest">

    <audio id="bgMusic" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=relaxing-music-vol1-124477.mp3" type="audio/mpeg">
    </audio>

    <svg class="deco-cloud animate-float top-10 left-10 w-24" viewBox="0 0 24 24"><path d="M17.5,19c-3.037,0-5.5-2.463-5.5-5.5c0-0.34,0.032-0.671,0.091-0.994C11.365,11.594,10.12,11,8.75,11c-2.485,0-4.5,2.015-4.5,4.5s2.015,4.5,4.5,4.5h8.75c2.485,0,4.5-2.015,4.5-4.5s-2.015-4.5-4.5-4.5c-0.377,0-0.739,0.048-1.085,0.136C16.142,8.966,14.07,7.5,11.5,7.5c-3.037,0-5.5,2.463-5.5,5.5c0,0.34-0.032,0.671-0.091,0.994C5.165,12.594,4.12,12,2.75,12C0.265,12-1.75,14.015-1.75,16.5s2.015,4.5,4.5,4.5h14.75c2.485,0,4.5-2.015,4.5-4.5S19.985,19,17.5,19z"/></svg>
    <svg class="deco-cloud animate-float-delayed top-32 right-20 w-16 opacity-50" viewBox="0 0 24 24"><path d="M17.5,19c-3.037,0-5.5-2.463-5.5-5.5c0-0.34,0.032-0.671,0.091-0.994C11.365,11.594,10.12,11,8.75,11c-2.485,0-4.5,2.015-4.5,4.5s2.015,4.5,4.5,4.5h8.75c2.485,0,4.5-2.015,4.5-4.5s-2.015-4.5-4.5-4.5c-0.377,0-0.739,0.048-1.085,0.136C16.142,8.966,14.07,7.5,11.5,7.5c-3.037,0-5.5,2.463-5.5,5.5c0,0.34-0.032,0.671-0.091,0.994C5.165,12.594,4.12,12,2.75,12C0.265,12-1.75,14.015-1.75,16.5s2.015,4.5,4.5,4.5h14.75c2.485,0,4.5-2.015,4.5-4.5S19.985,19,17.5,19z"/></svg>
    
    <svg class="deco-leaf animate-float bottom-20 right-10 w-12" viewBox="0 0 24 24"><path d="M17,8C8,10,5.9,16.17,3.82,21.34L5.71,22l1-2.3A4.49,4.49,0,0,0,8,20C19,20,22,3,22,3,11,5,14,8.5,13.75,10.25,12.8,17.5,6,17,6,17S16,16,17,8Z"/></svg>
    <div class="absolute top-1/4 left-1/4 w-3 h-3 rounded-full bg-mint animate-pulse-gentle"></div>
    <div class="absolute bottom-1/3 left-1/3 w-4 h-4 rounded-full bg-accent animate-pulse-gentle" style="animation-delay: 2s"></div>

    <div class="container mx-auto px-4 py-8 flex flex-col items-center relative z-10 max-w-md bg-card backdrop-blur-md rounded-3xl shadow-xl border border-white/50">
        
        <header class="text-center mb-8 w-full">
            <button id="muteBtn" onclick="toggleMute()" class="absolute top-6 right-6 text-2xl opacity-50 hover:opacity-100 transition-opacity">ğŸ”Š</button>
            <h1 class="text-4xl font-bold text-forest mb-2 tracking-wide">å¿ƒçµèŠ±å›­ ğŸŒ¿</h1>
            <p class="text-gray-500 text-sm">è®©å¿ƒçµåœ¨å®é™ä¸­ç»½æ”¾</p>
        </header>

        <div class="flex items-center justify-between w-full px-8 mb-10">
            <div class="step-dot active" id="step1"></div> <div class="step-line"></div>
            <div class="step-dot" id="step2"></div> <div class="step-line"></div>
            <div class="step-dot" id="step3"></div> <div class="step-line"></div>
            <div class="step-dot" id="step4"></div> <div class="step-line"></div>
            <div class="step-dot" id="step5"></div>
        </div>
        <div class="text-xs text-gray-400 mb-6 font-bold" id="stepLabel">å‡†å¤‡é˜¶æ®µ</div>

        <div id="breathContainer" class="breathing-circle-container mb-8">
            <div class="breathing-circle"></div>
            <div class="circle-text" id="phaseLabel">å¼€å§‹</div>
        </div>

        <div class="text-center mb-8">
            <p class="text-xs text-gray-400 mb-1 font-bold tracking-widest">MINDFULNESS TIME</p>
            <p class="text-5xl font-bold text-forest tabular-nums" id="timer">00:00</p>
        </div>

        <div class="flex items-center gap-4">
            <button onclick="toggleTimer()" id="mainBtn" class="bg-forest text-white px-8 py-4 rounded-full text-lg font-bold shadow-lg hover:bg-[#254228] hover:scale-105 transition-all flex items-center gap-2">
                <span id="playIcon">â–¶</span> <span id="btnText">å¼€å§‹æ—…ç¨‹</span>
            </button>
            
            <button onclick="resetTimer()" class="w-14 h-14 rounded-full border-2 border-forest text-forest flex items-center justify-center hover:bg-forest hover:text-white transition-all">
                â†º
            </button>
        </div>

        <div class="mt-8 bg-white/50 px-4 py-2 rounded-xl text-xs text-gray-500">
             ğŸ’¡ å°è´´å£«: æ‰¾ä¸€ä¸ªå®‰é™çš„åœ°æ–¹ï¼Œæ”¾æ¾è‚©è†€
        </div>
    </div>

    <script>
        // --- é…ç½®æ•°æ® ---
        // å‘¼å¸é˜¶æ®µæ—¶é•¿ (ç§’)
        const PHASE_DURATION = {
            inhale: 4,  // å¸æ°”
            hold: 4,    // ä¿æŒ
            exhale: 4,  // å‘¼æ°”
            rest: 2     // æ”¾æ¾
        };

        const PHASE_TEXT = {
            inhale: "å¸æ°”...",
            hold: "ä¿æŒ...",
            exhale: "å‘¼æ°”...",
            rest: "æ”¾æ¾..."
        };

        // è¯­éŸ³å¼•å¯¼è¯ (æ ¹æ®æ—¶é—´è§¦å‘)
        const GUIDE_STEPS = [
            { time: 2, text: "æ¬¢è¿æ¥åˆ°å¿ƒçµèŠ±å›­ã€‚æ‰¾ä¸ªèˆ’æœçš„å§¿åŠ¿åå¥½ã€‚" },
            { time: 10, text: "è½»è½»é—­ä¸Šçœ¼ç›ï¼ŒæŠŠæ³¨æ„åŠ›å¸¦å›åˆ°è¿™é‡Œã€‚" },
            { time: 20, text: "ç°åœ¨ï¼Œè·Ÿç€å‘¼å¸çƒçš„èŠ‚å¥ã€‚å¸æ°”..." },
            { time: 40, text: "æ„Ÿå—ç©ºæ°”æµè¿‡é¼»è…”ï¼Œé‚£æ˜¯ç”Ÿå‘½çš„èƒ½é‡ã€‚" },
            { time: 60, text: "å¦‚æœæ€ç»ªé£˜èµ°äº†ï¼Œæ¸©æŸ”åœ°æŠŠå®ƒæ‹‰å›æ¥ï¼Œæ²¡å…³ç³»ã€‚" },
            { time: 90, text: "ä½ å¾ˆå®‰å…¨ï¼Œä½ å¾ˆæ”¾æ¾ã€‚" },
            { time: 120, text: "æ”¾æ¾ä½ çš„çœ‰å¿ƒï¼Œæ”¾æ¾ä½ çš„ä¸‹å·´ã€‚" },
            { time: 150, text: "åšå¾—å¾ˆå¥½ï¼Œä¿æŒè¿™ç§å¹³é™çš„æ„Ÿè§‰ã€‚" },
            { time: 170, text: "å‡†å¤‡ç»“æŸäº†ï¼ŒåŠ¨åŠ¨æ‰‹æŒ‡ã€‚" },
        ];

        // --- å˜é‡ ---
        let totalSeconds = 0;
        let timerInterval = null;
        let isActive = false;
        let currentPhase = 'rest'; // inhale, hold, exhale, rest
        let phaseTimeLeft = 0;
        let isMuted = false;
        let guideIndex = 0;

        // --- DOM å…ƒç´  ---
        const timerDisplay = document.getElementById('timer');
        const phaseLabel = document.getElementById('phaseLabel');
        const breathContainer = document.getElementById('breathContainer');
        const mainBtn = document.getElementById('mainBtn');
        const btnText = document.getElementById('btnText');
        const playIcon = document.getElementById('playIcon');
        const bgMusic = document.getElementById('bgMusic');
        const muteBtn = document.getElementById('muteBtn');
        const stepLabel = document.getElementById('stepLabel');

        // è®¾ç½®éŸ³ä¹éŸ³é‡
        bgMusic.volume = 0.5;

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function toggleTimer() {
            if (isActive) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            isActive = true;
            updateBtnUI(true);
            bgMusic.play();
            
            // å¦‚æœæ˜¯åˆšå¼€å§‹ï¼Œè¿›å…¥å¸æ°”å‡†å¤‡
            if (totalSeconds === 0) {
                switchPhase('inhale');
                speak("æ¬¢è¿æ¥åˆ°å¿ƒçµèŠ±å›­");
            }

            timerInterval = setInterval(() => {
                totalSeconds++;
                updateTimerDisplay(totalSeconds);
                updateSteps(totalSeconds);
                checkGuide(totalSeconds); // æ£€æŸ¥æ˜¯å¦æœ‰è¯­éŸ³å¼•å¯¼

                // å‘¼å¸é˜¶æ®µå€’è®¡æ—¶
                phaseTimeLeft--;
                if (phaseTimeLeft <= 0) {
                    nextPhase();
                }
                
                // æ›´æ–°ä¸­é—´çš„å¤§å­—
                if (phaseTimeLeft > 0) {
                     phaseLabel.textContent = phaseTimeLeft; // æ˜¾ç¤ºå€’æ•°æ•°å­—
                } else {
                     phaseLabel.textContent = PHASE_TEXT[currentPhase];
                }

            }, 1000);
        }

        function pauseTimer() {
            isActive = false;
            clearInterval(timerInterval);
            updateBtnUI(false);
            bgMusic.pause();
            window.speechSynthesis.cancel();
            breathContainer.className = "breathing-circle-container"; // ç§»é™¤å‘¼å¸ç±»ï¼Œåœæ­¢åŠ¨ç”»
        }

        function resetTimer() {
            pauseTimer();
            totalSeconds = 0;
            guideIndex = 0;
            currentPhase = 'rest';
            updateTimerDisplay(0);
            phaseLabel.textContent = "å¼€å§‹";
            stepLabel.textContent = "å‡†å¤‡é˜¶æ®µ";
            resetSteps();
            bgMusic.currentTime = 0;
        }

        function nextPhase() {
            const sequence = ['inhale', 'hold', 'exhale', 'rest'];
            const currentIndex = sequence.indexOf(currentPhase);
            const nextIndex = (currentIndex + 1) % sequence.length;
            switchPhase(sequence[nextIndex]);
        }

        function switchPhase(phase) {
            currentPhase = phase;
            phaseTimeLeft = PHASE_DURATION[phase];
            
            // æ›´æ–°åŠ¨ç”»ç±»
            breathContainer.className = `breathing-circle-container ${phase}`;
            
            // å¦‚æœæ˜¯å¸æ°”æˆ–å‘¼æ°”ï¼Œè¯»å‡ºæ¥
            if (phase === 'inhale') speak("å¸æ°”");
            if (phase === 'exhale') speak("å‘¼æ°”");
        }

        // --- è¾…åŠ©åŠŸèƒ½ ---

        function updateTimerDisplay(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${m}:${s}`;
        }

        function updateBtnUI(running) {
            if (running) {
                mainBtn.classList.add('bg-accent');
                mainBtn.classList.remove('bg-forest');
                btnText.textContent = "æš‚åœ";
                playIcon.textContent = "â¸";
            } else {
                mainBtn.classList.add('bg-forest');
                mainBtn.classList.remove('bg-accent');
                btnText.textContent = totalSeconds > 0 ? "ç»§ç»­" : "å¼€å§‹æ—…ç¨‹";
                playIcon.textContent = "â–¶";
            }
        }

        function updateSteps(sec) {
            // æ ¹æ®æ—¶é—´ç®€å•çš„æ¨è¿›è¿›åº¦æ¡
            const stepDots = document.querySelectorAll('.step-dot');
            const labels = ["å‡†å¤‡", "å‘¼å¸", "ä¸“æ³¨", "æ”¾æ¾", "å®Œæˆ"];
            let activeIndex = 0;
            
            if (sec > 10) activeIndex = 1;
            if (sec > 60) activeIndex = 2;
            if (sec > 120) activeIndex = 3;
            if (sec > 160) activeIndex = 4;

            stepDots.forEach((dot, idx) => {
                if (idx <= activeIndex) dot.classList.add('active');
                else dot.classList.remove('active');
            });
            
            stepLabel.textContent = labels[activeIndex];
        }

        function resetSteps() {
            document.querySelectorAll('.step-dot').forEach(d => d.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
        }

        // --- è¯­éŸ³åˆæˆ ---
        function checkGuide(sec) {
            const guide = GUIDE_STEPS.find(g => g.time === sec);
            if (guide) {
                speak(guide.text);
            }
        }

        function speak(text) {
            if (isMuted) return;
            window.speechSynthesis.cancel(); // æ‰“æ–­ä¹‹å‰çš„
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            const zhVoice = voices.find(v => v.lang === 'zh-CN') || voices.find(v => v.lang.includes('zh'));
            if (zhVoice) utterance.voice = zhVoice;
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function toggleMute() {
            isMuted = !isMuted;
            muteBtn.textContent = isMuted ? "ğŸ”‡" : "ğŸ”Š";
            muteBtn.style.opacity = isMuted ? "1" : "0.5";
        }
        
        // åˆå§‹åŒ–åŠ è½½è¯­éŸ³
        window.speechSynthesis.onvoiceschanged = () => {};
    </script>
</body>
</html>
